@page
@model EasyLearn.Pages.Cards.IndexModel

@{
    ViewData["Title"] = "Index";
}

<div class="top-page-card">
<style>
    body {
        background-color: #0A082D;
    }
</style>

<h1 class="create-title" style="position:relative; left:100px;">List: @Model.TrainingModule.Name</h1>

<div class="card-container">
    <div class="card" id="flashcard">
        <div class="card-face card-front">
            <span id="card-term">@Model.Card.FirstOrDefault()?.Term</span>
        </div>
        <div class="card-face card-back">
            <span id="card-definition">@Model.Card.FirstOrDefault()?.Definition</span>
        </div>
    </div>
</div>

<div class="navigation-buttons">
    <button id="prevBtn" disabled>⭠</button>
    <button id="nextBtn" @(Model.Card.Count <= 1 ? "disabled" : "")>⭢</button>
</div>

<div class="card-index">
    <span id="cardCounter">1/@Model.Card.Count</span>
</div>
<a asp-page="../TrainingModules/Edit" asp-route-id="@Model.TrainingModuleId">
    <div class="edit-card"></div>
</a>

<div class="game-container">
    <input type="button" name="name" value="Classic" class="classic-game-button" />
    <input type="button" name="name" value="Random" class="random-game-button" />
    <input type="button" name="name" value="Exam" class="test-game-button" />
</div>

<!-- Контейнер для нових кнопок екзамену -->
<div id="examButtonsContainer"></div>

<div id="currentMode" class="current-mode">Classic</div>
</div>
<script>
    // Отримуємо картки з моделі
    const originalCards = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Card.Select(c => new { c.Term, c.Definition })));
    console.log('Original Cards:', originalCards); // Дебаг
    let currentCards = [...originalCards]; // Поточний набір карток
    let currentIndex = 0;
    let isFlipped = false;

    const flashcard = document.getElementById('flashcard');
    const cardTerm = document.getElementById('card-term');
    const cardDefinition = document.getElementById('card-definition');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const cardCounter = document.getElementById('cardCounter');
    const currentMode = document.getElementById('currentMode');

    const classicBtn = document.querySelector('.classic-game-button');
    const randomBtn = document.querySelector('.random-game-button');
    const examBtn = document.querySelector('.test-game-button');

    const examButtonsContainer = document.getElementById('examButtonsContainer'); // Контейнер для нових кнопок

    // Додаємо обробники подій для кнопок режимів
    classicBtn.addEventListener('click', () => {
        currentCards = [...originalCards];
        resetQuiz();
        updateCurrentMode('Classic');
        removeExamButtons(); // Видаляємо додаткові кнопки, якщо вони є
    });

    randomBtn.addEventListener('click', () => {
        currentCards = shuffleArray([...originalCards]);
        resetQuiz();
        updateCurrentMode('Random');
        removeExamButtons(); // Видаляємо додаткові кнопки, якщо вони є
    });

    examBtn.addEventListener('click', () => {
        currentCards = generateExamCards(originalCards, Math.min(originalCards.length, 12)); // Генеруємо картки екзамену
        resetQuiz();
        updateCurrentMode('Exam');

        // Створення трьох нових кнопок при натисканні на "Exam"
        createExamButtons();
    });

    // Функція для створення трьох кнопок екзамену
    function createExamButtons() {
        // Перевіряємо, чи вже створені кнопки
        if (document.getElementById('examButton1')) return;

        // Створюємо кнопку 1
        const button1 = document.createElement('input');
        button1.type = 'button';
        button1.name = 'examSub';
        button1.value = 'Easy';
        button1.id = 'examButton1';
        button1.className = 'exam-sub-button';
        examButtonsContainer.appendChild(button1);

        // Створюємо кнопку 2
        const button2 = document.createElement('input');
        button2.type = 'button';
        button2.name = 'examSub';
        button2.value = 'Medium';
        button2.id = 'examButton2';
        button2.className = 'exam-sub-button';
        examButtonsContainer.appendChild(button2);

        // Створюємо кнопку 3
        const button3 = document.createElement('input');
        button3.type = 'button';
        button3.name = 'examSub';
        button3.value = 'Hard';
        button3.id = 'examButton3';
        button3.className = 'exam-sub-button';
        examButtonsContainer.appendChild(button3);
    }

    // Функція для видалення трьох кнопок екзамену
    function removeExamButtons() {
        while (examButtonsContainer.firstChild) {
            examButtonsContainer.removeChild(examButtonsContainer.firstChild);
        }
    }

    // Клік по картці для перевертання
    flashcard.addEventListener('click', () => {
        flashcard.classList.toggle('flipped');
        isFlipped = !isFlipped;
    });

    // Клік по кнопці "Назад"
    prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
            currentIndex--;
            updateCard();
        }
    });

    // Клік по кнопці "Вперед"
    nextBtn.addEventListener('click', () => {
        if (currentIndex < currentCards.length - 1) {
            currentIndex++;
            updateCard();
        }
    });

    // Функція для перемішування масиву (Рандомний режим)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Функція для генерації карток для екзамену
    function generateExamCards(array, total) {
        if (array.length >= total) {
            return shuffleArray([...array]).slice(0, total);
        } else {
            const result = [];
            for (let i = 0; i < total; i++) {
                const randomIndex = Math.floor(Math.random() * array.length);
                result.push(array[randomIndex]);
            }
            return result;
        }
    }

    // Функція для оновлення картки
    function updateCard() {
        if (isFlipped) {
            flashcard.classList.remove('flipped');
            isFlipped = false;

            flashcard.addEventListener('transitionend', function handler() {
                cardTerm.textContent = currentCards[currentIndex].Term;
                cardDefinition.textContent = currentCards[currentIndex].Definition;

                prevBtn.disabled = currentIndex === 0;
                nextBtn.disabled = currentIndex === currentCards.length - 1;

                cardCounter.textContent = `${currentIndex + 1}/${currentCards.length}`;

                flashcard.removeEventListener('transitionend', handler);
            });
        } else {
            cardTerm.textContent = currentCards[currentIndex].Term;
            cardDefinition.textContent = currentCards[currentIndex].Definition;

            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === currentCards.length - 1;

            cardCounter.textContent = `${currentIndex + 1}/${currentCards.length}`;
        }
    }

    // Функція для скидання стану квізу
    function resetQuiz() {
        currentIndex = 0;
        isFlipped = false;
        flashcard.classList.remove('flipped');
        updateCard();
    }

    // Функція для оновлення поточного режиму
    function updateCurrentMode(mode) {
        currentMode.textContent = `${mode}`;
    }

    // Ініціалізація при завантаженні сторінки
    updateCard();
    updateCurrentMode('Classic'); // Встановлюємо початковий режим
</script>
